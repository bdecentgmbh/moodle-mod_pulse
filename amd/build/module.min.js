/**
 * Module javascript to place the placeholders.
 * Modified version of IOMAD Email template emailvars.
 *
 * @module   mod_pulse/module
 * @category  Classes - autoloading
 * @copyright 2021, bdecent gmbh bdecent.de
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_pulse/module",["core_editor/events"],(function(){return{init:function(branch){for(var module=this,templatevars=document.getElementsByClassName("fitem_id_templatevars_editor"),l=0;l<templatevars.length;l++)templatevars[l].addEventListener("click",(function(){var EditorInput=document.getElementById("id_pulse_content_editoreditable");null!==EditorInput&&module.insertCaretActive(EditorInput)}));var notificationheader=document.getElementById("admin-notificationheader");null!==notificationheader&&notificationheader.addEventListener("click",(function(){var EditorInput=branch<="402"?document.getElementById("id_s_mod_pulse_notificationheadereditable"):document.getElementById("id_s_mod_pulse_notificationheader_ifr");module.insertCaretActive(EditorInput)}));var notificationfooter=document.getElementById("admin-notificationfooter");null!==notificationfooter&&notificationfooter.addEventListener("click",(function(){var EditorInput=branch<="402"?document.getElementById("id_s_mod_pulse_notificationfootereditable"):document.getElementById("id_s_mod_pulse_notificationfooter_ifr");module.insertCaretActive(EditorInput)})),(templatevars=document.getElementsByClassName("fitem_id_templatevars_editor"))&&templatevars.forEach((elem=>{elem.addEventListener("click",(function(e){var target=e.currentTarget,EditorInput=branch<="402"?target.querySelector('[id*="_editoreditable"]'):target.querySelector('textarea[id*="_content_editor"]');module.insertCaretActive(EditorInput)}))}));var headertargetNode=document.querySelector("#id_s_mod_pulse_notificationheader");if(null!==headertargetNode){new MutationObserver((function(){if("none"==headertargetNode.style.display&&null!==document.querySelector("#admin-notificationheader iframe")){var headercontent=document.querySelector("#admin-notificationheader iframe").contentDocument;headercontent.addEventListener("click",(function(){var headercontentBody=headercontent.querySelector("body");null!==headercontentBody&&headercontentBody.classList.add("insertatcaretactive");var footerBody=document.querySelector("#admin-notificationfooter iframe").contentDocument.querySelector("body");footerBody.classList.contains("insertatcaretactive")&&footerBody.classList.remove("insertatcaretactive")}))}})).observe(headertargetNode,{attributes:!0,childList:!0})}var footertargetNode=document.querySelector("#id_s_mod_pulse_notificationfooter");if(null!==footertargetNode){new MutationObserver((function(){if("none"==footertargetNode.style.display&&null!==document.querySelector("#admin-notificationfooter iframe")){var footercontent=document.querySelector("#admin-notificationfooter iframe").contentDocument;footercontent.addEventListener("click",(function(){var footercontentBody=footercontent.querySelector("body");null!==footercontentBody&&footercontentBody.classList.add("insertatcaretactive");var headerBody=document.querySelector("#admin-notificationheader iframe").contentDocument.querySelector("body");headerBody.classList.contains("insertatcaretactive")&&headerBody.classList.remove("insertatcaretactive")}))}})).observe(footertargetNode,{attributes:!0,childList:!0})}var targetNode=document.querySelector("textarea[id$=_editor]");if(null!==targetNode){new MutationObserver((function(){"none"==targetNode.style.display&&setTimeout(initIframeListeners,100)})).observe(targetNode,{attributes:!0,childList:!0})}const initIframeListeners=()=>{let iframes=document.querySelectorAll('[data-fieldtype="editor"] iframe');return!(null===iframes||!iframes.length)&&(iframes.forEach((iframe=>{iframe.contentDocument.addEventListener("click",(function(){iframes.forEach((frame=>{var frameElem=frame.contentDocument.querySelector(".insertatcaretactive");null!==frameElem&&frameElem.classList.remove("insertatcaretactive")}));var contentBody=iframe.contentDocument.querySelector("body");null!==contentBody&&contentBody.classList.add("insertatcaretactive")}))})),!0)};for(var clickforword=document.getElementsByClassName("clickforword"),i=0;i<clickforword.length;i++)clickforword[i].addEventListener("click",(function(e){e.preventDefault();var content="{"+this.getAttribute("data-text")+"}";let iframes=document.querySelectorAll('[data-fieldtype="editor"] iframe');if(navigator.clipboard.writeText(content),null===iframes||!iframes.length){var headerNode=document.querySelector("#admin-notificationheader iframe");if(null!==headerNode){var headerNodeiframe=headerNode.contentDocument;if(null!==headerNodeiframe){var headercontentBody=headerNodeiframe.querySelector("body");if(headercontentBody.classList.contains("insertatcaretactive")){headercontentBody.classList.add("insertatcaretactive");const id=headercontentBody.dataset.id;return window.tinyMCE.get(id).selection.setContent(content),!0}}}var footerNode=document.querySelector("#admin-notificationfooter iframe");if(null!==footerNode){var footerNodeiframe=footerNode.contentDocument;if(null!==footerNodeiframe){var footercontentBody=footerNodeiframe.querySelector("body");if(footercontentBody.classList.contains("insertatcaretactive")){footercontentBody.classList.add("insertatcaretactive");const id=footercontentBody.dataset.id;return window.tinyMCE.get(id).selection.setContent(content),!0}}}}var tinyEditor;return iframes.forEach((function(frame){if(null!==frame.contentDocument.querySelector(".insertatcaretactive")){var contentBody=frame.contentDocument.querySelector("body");if(null!==contentBody){contentBody.classList.add("insertatcaretactive");const id=contentBody.dataset.id;var editor=window.tinyMCE.get(id);tinyEditor=editor}}})),tinyEditor?tinyEditor.selection.setContent(content):module.insertAtCaret(content),!0}));if(null!==document.getElementById("page-mod-pulse-mod")&&null!==document.getElementById("page-mod-pulse-mod").querySelector("#fgroup_id_completionrequireapproval [data-fieldtype='autocomplete']")){this.getAllTextNodes(document.getElementById("page-mod-pulse-mod").querySelector("#fgroup_id_completionrequireapproval [data-fieldtype='autocomplete']")).forEach((node=>{const span=document.createElement("span");span.classList="badge badge-info pulse-completion-roles",node.after(span),span.appendChild(node)}))}},insertCaretActive:function(EditorInput){if(null!==EditorInput){for(var caret=document.getElementsByClassName("insertatcaretactive"),j=0;j<caret.length;j++)caret[j].classList.remove("insertatcaretactive");EditorInput.classList.add("insertatcaretactive")}},getAllTextNodes:function(element){return Array.from(element.childNodes).filter((node=>3===node.nodeType&&node.textContent.trim().length>1))},isSelectionInsideDiv:div=>{const selection=window.getSelection();if(0===selection.rangeCount)return!1;const startNode=selection.getRangeAt(0).startContainer,endNode=selection.getRangeAt(0).endContainer;return div.contains(startNode)&&div.contains(endNode)},insertAtCaret:function(myValue){for(var sel,range,caretelements=document.getElementsByClassName("insertatcaretactive"),n=0;n<caretelements.length;n++){var thiselem=caretelements[n];if(void 0===thiselem.value&&window.getSelection&&this.isSelectionInsideDiv(thiselem)){if((sel=window.getSelection()).getRangeAt&&sel.rangeCount){(range=sel.getRangeAt(0)).deleteContents(),range.insertNode(document.createTextNode(myValue));for(let position=0;position!=myValue.length+1;position++)sel.modify("move","right","character")}}else void 0===thiselem.value&&document.selection&&document.selection.createRange&&((range=document.selection.createRange()).text=myValue);if(void 0!==thiselem.value)if(document.selection)thiselem.focus(),(sel=document.selection.createRange()).text=myValue,thiselem.focus();else if(thiselem.selectionStart||"0"==thiselem.selectionStart){var startPos=thiselem.selectionStart,endPos=thiselem.selectionEnd;thiselem.value=thiselem.value.substring(0,startPos)+myValue+thiselem.value.substring(endPos,thiselem.value.length),thiselem.focus(),thiselem.selectionStart=startPos+myValue.length,thiselem.selectionEnd=startPos+myValue.length,thiselem.focus()}else thiselem.value+=myValue,thiselem.focus()}}}}));

//# sourceMappingURL=module.min.js.map