{"version":3,"file":"completion.min.js","sources":["../src/completion.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Module javascript to place the placeholders.\r\n * Modified version of IOMAD Email template emailvars.\r\n *\r\n * @module  mod_pulse/completion\r\n * @category  Classes - autoloading\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['core/fragment'], function(Fragment) {\r\n\r\n    return {\r\n\r\n        /**\r\n         * Update completion buttons for each activity based on user role.\r\n         * This will load the template using fragment.\r\n         */\r\n        updatecompletionbuttons: function() {\r\n            var instances = document.getElementsByClassName('modtype_pulse');\r\n            var modules = []; var moduleid;\r\n            for (var i = 0; i < instances.length; i++) {\r\n                var instance = instances[i];\r\n                var id = instance.getAttribute('id');\r\n                moduleid = parseInt(id.replace('module-', ''));\r\n                modules.push(moduleid);\r\n            }\r\n            var params = {modules:  JSON.stringify(modules)};\r\n            if (modules.length > 0) {\r\n                let completionbuttons = Fragment.loadFragment('mod_pulse', 'completionbuttons', 1, params);\r\n                var approvebtn, element, referenceNode, completioncontent;\r\n                completionbuttons.then((data) => {\r\n                    data = JSON.parse(data);\r\n                    for (var k in data) {\r\n                        approvebtn = data[k];\r\n                        element = document.getElementById('module-' + k);\r\n                        referenceNode = element.getElementsByClassName('contentwithoutlink')[0];\r\n                        completioncontent = document.createElement('div');\r\n                        completioncontent.innerHTML = approvebtn;\r\n                        completioncontent.classList.add('pulse-completion-btn');\r\n                        referenceNode.parentNode.insertBefore(completioncontent, referenceNode.nextSibling);\r\n                    }\r\n                    return true;\r\n                }).fail();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * If the page is course view page then call the completion buttons to insert.\r\n         */\r\n        init: function() {\r\n            if (document.body.classList.contains('path-course-view')) {\r\n                this.updatecompletionbuttons();\r\n            }\r\n        },\r\n\r\n    };\r\n});\r\n"],"names":["define","Fragment","updatecompletionbuttons","moduleid","instances","document","getElementsByClassName","modules","i","length","id","getAttribute","parseInt","replace","push","params","JSON","stringify","approvebtn","element","referenceNode","completioncontent","loadFragment","then","data","k","parse","getElementById","createElement","innerHTML","classList","add","parentNode","insertBefore","nextSibling","fail","init","body","contains"],"mappings":";;;;;;;;;AAyBAA,8BAAO,CAAC,kBAAkB,SAASC,gBAExB,CAMHC,wBAAyB,mBAECC,SADlBC,UAAYC,SAASC,uBAAuB,iBAC5CC,QAAU,GACLC,EAAI,EAAGA,EAAIJ,UAAUK,OAAQD,IAAK,KAEnCE,GADWN,UAAUI,GACPG,aAAa,MAC/BR,SAAWS,SAASF,GAAGG,QAAQ,UAAW,KAC1CN,QAAQO,KAAKX,cAEbY,OAAS,CAACR,QAAUS,KAAKC,UAAUV,aACnCA,QAAQE,OAAS,EAAG,KAEhBS,WAAYC,QAASC,cAAeC,kBADhBpB,SAASqB,aAAa,YAAa,oBAAqB,EAAGP,QAEjEQ,MAAMC,WAEf,IAAIC,KADTD,KAAOR,KAAKU,MAAMF,MAEdN,WAAaM,KAAKC,GAClBN,QAAUd,SAASsB,eAAe,UAAYF,GAC9CL,cAAgBD,QAAQb,uBAAuB,sBAAsB,IACrEe,kBAAoBhB,SAASuB,cAAc,QACzBC,UAAYX,WAC9BG,kBAAkBS,UAAUC,IAAI,wBAChCX,cAAcY,WAAWC,aAAaZ,kBAAmBD,cAAcc,oBAEpE,KACRC,SAOXC,KAAM,WACE/B,SAASgC,KAAKP,UAAUQ,SAAS,0BAC5BpC"}